<!DOCTYPE html>
<html>

<head>
    <title>Card Reader</title>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
</head>

<body>
    <h1>Card Reader 3</h1>
    <video id="preview" style="width:100%; max-width:480px;"></video>
    <div>
        <button onclick="scanCard()">Scan Card</button>
    </div>
    <div id="cardInfoDisplay"></div>
    <div>
        <input type="text" id="cardNumberInput" placeholder="Enter Card Number">
    </div>

    <script>
        let scanner = new Instascan.Scanner({ video: document.getElementById('preview'), mirror: false });

        const cards = [
            {
                cardNumber: "12345678",
                password: "1234",
                ownerName: "mohamad",
                balance: 1000
            },
            {
                cardNumber: "87654321",
                password: "4321",
                ownerName: "John Doe",
                balance: 500
            },
            // Add more card objects as needed
        ];

        function scanCard() {
            scanner.addListener('scan', function (content) {
                const scannedCard = cards.find(card => card.cardNumber === content);
                if (scannedCard) {
                    askPassword(scannedCard);
                } else {
                    alert("Card not recognized.");
                }
            });

            Instascan.Camera.getCameras().then(function (cameras) {
                if (cameras.length > 0) {
                    scanner.start(cameras[cameras.length - 1]);
                } else {
                    console.error('No cameras found.');
                }
            }).catch(function (e) {
                console.error(e);
            });
        }

        function askPassword(card) {
            const password = prompt("Enter Password:");
            if (password === card.password) {
                askAmount(card);
            } else {
                alert("Invalid password.");
            }
        }

        function askAmount(card) {
            const amount = prompt("Enter Amount:");
            const parsedAmount = parseInt(amount);
            if (!isNaN(parsedAmount)) {
                if (parsedAmount <= card.balance) {
                    updateBalance(card, parsedAmount);
                } else {
                    alert("Insufficient balance.");
                }
            } else {
                alert("Invalid amount.");
            }
        }

        function updateBalance(card, amount) {
            // Find the index of the card in the array
            const index = cards.findIndex(c => c.cardNumber === card.cardNumber);
            if (index !== -1) {
                // Update the balance
                cards[index].balance -= amount;
                // Update the display
                displayCardInfo(cards[index]);
            }
        }

        function displayCardInfo(card) {
            const cardInfoDisplay = document.getElementById('cardInfoDisplay');
            cardInfoDisplay.innerHTML = `
                <h2>Card Information</h2>
                <p><strong>Card Number:</strong> ${card.cardNumber}</p>
                <p><strong>Owner's Name:</strong> ${card.ownerName}</p>
                <p><strong>Balance:</strong> $${card.balance}</p>
            `;
        }
    </script>
</body>

</html>
